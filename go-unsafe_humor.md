# åˆ«å†ç›²ç›®æ¨å´‡ç±»å‹å®‰å…¨äº†ï¼Go çš„è¿™ä¸ªâ€œæ€§èƒ½ç‚¸å¼¹â€æ‰æ˜¯å¤§å‚èµ·é£çš„ç§˜å¯†

> **ä½œè€…ï¼š** è€ç²¥  
> **æ—¶é—´ï¼š** 2026 å¹´ 2 æœˆ

å‡Œæ™¨3:47åˆ†ï¼Œä¼ä¸šå¾®ä¿¡ç ¸è¿‡æ¥ä¸€æ¡æ¶ˆæ¯ï¼š"æ—¥å¿—æœåŠ¡åˆæŒ‚äº†ï¼Ÿ"

æˆ‘ç¡çœ¼æƒºå¿ªåœ°çœ‹ç€ç›‘æ§ï¼Œå†…å­˜å ç”¨ä»500MBç¬é—´é£™åˆ°2GBï¼Œç„¶åè¿›ç¨‹è¢«OOM Killeræ— æƒ…åœ°æ€æ­»ã€‚æˆ‘çŸ¥é“è¿™ä¸ªé—®é¢˜äº†â€”â€”æˆ‘ä»¬çš„æ—¥å¿—è§£ææœåŠ¡åœ¨é«˜å³°æœŸåšäº†å¤ªå¤š`string`è½¬`[]byte`çš„æ“ä½œï¼Œæ¯æ¬¡è½¬æ¢éƒ½è¦æ‹·è´æ•´ä¸ªæ—¥å¿—å†…å®¹ã€‚ä¸€æ¡10MBçš„æ—¥å¿—ï¼Œè½¬ä¸€æ¬¡å°±å˜æˆ20MBçš„å†…å­˜å ç”¨ã€‚

"é‚£å°±åˆ«è½¬äº†å•Šï¼"è€æ¿è¯´ã€‚

"ä½†ä¸‹æ¸¸çš„å¤„ç†å‡½æ•°éœ€è¦`[]byte`å•Š..."

"é‚£ä½ å°±æƒ³åŠæ³•çœæ‰è¿™ç¬”æ‹·è´çš„é’±ã€‚ä»Šæ™šä¸è§£å†³ï¼Œä½ å°±åˆ«ç¡äº†ã€‚"

æˆ‘çœ‹ç€å±å¹•ä¸Šçš„ä»£ç ï¼Œçªç„¶æƒ³èµ·äº†é‚£ä¸ªè¢«æˆ‘ä»¬éƒ½"æ•¬è€Œè¿œä¹‹"çš„åŒ…â€”â€”`unsafe`ã€‚

### ä¸ºä»€ä¹ˆå¤§å‚éƒ½åœ¨å·å·ç”¨ unsafeï¼Ÿ

å¾ˆå¤šåˆšæ¥è§¦ Go çš„åŒå­¦ï¼Œçœ‹åˆ° `unsafe` è¿™ä¸ªåŒ…åå°±ä¼šå¿ƒç”Ÿç•æƒ§ã€‚ç¡®å®ï¼Œå®˜æ–¹æ–‡æ¡£é‡Œåˆ°å¤„éƒ½æ˜¯â€œWarningâ€ã€‚ä½†ä½ å¦‚æœç¿»å¼€ `runtime`ã€`protocol buffer` ç”šè‡³ `gin` çš„æºç ï¼Œä½ ä¼šå‘ç° `unsafe` å‡ ä¹æ— å¤„ä¸åœ¨ã€‚

**ä¸ºä»€ä¹ˆï¼Ÿç­”æ¡ˆåªæœ‰ä¸¤ä¸ªå­—ï¼šæ€§èƒ½ã€‚**

åœ¨å¤„ç†æµ·é‡æ•°æ®ã€é«˜å¹¶å‘ç½‘ç»œåè®®è§£ææ—¶ï¼Œå“ªæ€•æ˜¯å¤šä¸€æ¬¡å†…å­˜æ‹·è´ï¼Œéƒ½å¯èƒ½æˆä¸ºç³»ç»Ÿçš„æ€§èƒ½ç“¶é¢ˆã€‚è€Œ `unsafe` ç»™äº†æˆ‘ä»¬ç›´æ¥æ“çºµå†…å­˜çš„èƒ½åŠ›ï¼Œè®©æˆ‘ä»¬å¯ä»¥ç»•è¿‡ç¼–è¯‘å™¨çš„æ¡æ¡æ¡†æ¡†ï¼Œå®ç°çœŸæ­£çš„â€œé›¶æ‹·è´â€ã€‚

## Pointerå’Œuintptrï¼Œä¸€ä¸ªæ˜¯å¥½å­©å­ä¸€ä¸ªæ˜¯åå­©å­

è¦ç©è½¬`unsafe`ï¼Œä½ å¿…é¡»å…ˆææ¸…æ¥šå®ƒçš„ä¸¤ä¸ªæ ¸å¿ƒç±»å‹ã€‚å¾ˆå¤šäººå°±åœ¨è¿™é‡Œæ ½äº†è·Ÿå¤´ï¼Œå¯¼è‡´ç¨‹åºåœ¨çº¿ä¸Šè«åå…¶å¦™Crashã€‚

| ç‰¹æ€§ | unsafe.Pointer | uintptr |
|------|---|---|
| æœ¬è´¨ | é€šç”¨æŒ‡é’ˆï¼ˆä¸‡èƒ½ç¿»è¯‘å®˜ï¼‰ | çº¯æ•°å­—ï¼ˆå°±æ˜¯ä¸ªå†…å­˜åœ°å€ï¼‰ |
| GCå‹å¥½ | ä¼šè¢«GCè·Ÿè¸ªï¼Œå†…å­˜ä¸ä¼šè¢«å›æ”¶ | ä¸ä¼šè¢«GCè·Ÿè¸ªï¼Œæå…¶å±é™© |
| èƒ½åŠ› | ä¸åŒç±»å‹æŒ‡é’ˆçš„è½¬æ¢ | å†…å­˜åœ°å€è®¡ç®—ï¼ˆåŠ å‡åç§»é‡ï¼‰ |
| é£é™©ç­‰çº§ | âš ï¸ ä½ï¼ˆå¦‚æœè§„åˆ™éµå¾ªï¼‰ | âš ï¸âš ï¸âš ï¸ é«˜ï¼ˆ"å¤±å¼•ç”¨"ä¹‹ç‹ï¼‰ |

ç®€å•è¯´ï¼š`unsafe.Pointer`æ˜¯è®©ä½ æ‹¿å»**ç”¨**çš„ï¼Œè€Œ`uintptr`åªæ˜¯è®©ä½ æ‹¿æ¥**ç®—åœ°å€**çš„ã€‚åƒä¸‡ä¸è¦é•¿æœŸæŒæœ‰`uintptr`ï¼Œå› ä¸ºGCéšæ—¶å¯èƒ½è§‰å¾—è¿™å—å†…å­˜æ²¡äººç”¨äº†ï¼Œç›´æ¥æŠŠå®ƒæ”¶èµ°ã€‚åˆ°æ—¶å€™ä½ çš„ç¨‹åºå°±åƒåœ¨é£ä¸­å‡Œä¹±çš„çº¸ç‰‡â€”â€”ä¸çŸ¥é“è‡ªå·±æŒ‡å‘å“ªå„¿äº†ã€‚

çœ‹è¿™ä¸ªä¾‹å­å°±æ˜ç™½äº†ï¼š

```go
package main

import (
	"fmt"
	"unsafe"
)

func main() {
	x := 100

	//  å®‰å…¨çš„åšæ³•ï¼šç”¨unsafe.Pointer
	p := unsafe.Pointer(&x)
	fPtr := (*float64)(p)
	*fPtr = 3.14159
	fmt.Println(x) // å†…å­˜è¢«é‡æ–°è§£è¯»ï¼Œä½†GCçŸ¥é“pæŒ‡å‘x

	//  å±é™©çš„åšæ³•ï¼šé•¿æœŸæŒæœ‰uintptr
	addr := uintptr(unsafe.Pointer(&x))
	// ... åšä¸€äº›å…¶ä»–æ“ä½œï¼ŒGCè¿è¡Œäº† ...
	// ç°åœ¨xå¯èƒ½è¢«ç§»åŠ¨æˆ–å›æ”¶äº†
	p2 := unsafe.Pointer(addr) // è¿™ä¸ªæŒ‡é’ˆå¯èƒ½å·²ç»å¤±æ•ˆï¼
	fmt.Println(*(*int)(p2))   // æœªå®šä¹‰è¡Œä¸ºï¼Œå¯èƒ½Crash
}
```

å®˜æ–¹æ–‡æ¡£é‡Œæ˜ç¡®è§„å®šäº†unsafe.Pointerçš„4ä¸ªåˆæ³•ç”¨é€”ã€‚è¶…å‡ºè¿™å››ä¸ªèŒƒå›´çš„æ“ä½œï¼Œéƒ½æ˜¯æœªå®šä¹‰è¡Œä¸ºâ€”â€”å¯èƒ½ä»Šå¤©èƒ½è·‘ï¼Œæ˜å¤©å‡çº§Goç‰ˆæœ¬å°±å´©ï¼š

1. **ç±»å‹è½¬æ¢**ï¼šæ¯”å¦‚`*int` â†’ `unsafe.Pointer` â†’ `*float64`ï¼Œè¿™æ˜¯æœ€å¸¸è§çš„ç”¨æ³•
2. **åœ°å€è®¡ç®—**ï¼šé€šè¿‡`uintptr`åšåŠ å‡è¿ç®—ï¼Œä½†å¿…é¡»"ç«‹å³ä½¿ç”¨"ï¼ˆä¸èƒ½å­˜å‚¨ï¼‰
3. **ä¸nilæ¯”è¾ƒ**ï¼šæ£€æŸ¥æŒ‡é’ˆæ˜¯å¦ä¸ºç©º
4. **ä½œä¸ºmapçš„key**ï¼šè™½ç„¶å¾ˆå°‘ç”¨ï¼Œä½†æŠ€æœ¯ä¸Šæ”¯æŒ

## å†…å­˜å¯¹é½è¿™ä¸ªéšå½¢ç‚¸å¼¹

ç†è§£`unsafe`çš„å…³é”®ï¼Œæ˜¯ç†è§£Goçš„å†…å­˜å¸ƒå±€è§„åˆ™ã€‚è¿™ä¸æ˜¯ä»€ä¹ˆç¥ç§˜çš„é»‘é­”æ³•ï¼Œè€Œæ˜¯ç¡®å®šæ€§çš„æ•°å­¦ã€‚

Goçš„structå­—æ®µä¸æ˜¯ç´§å¯†æ’åˆ—çš„ã€‚ä¸ºäº†è®©CPUè®¿é—®æ•ˆç‡æœ€é«˜ï¼Œç¼–è¯‘å™¨ä¼šåœ¨å­—æ®µä¹‹é—´æ’å…¥"å¡«å……å­—èŠ‚"ã€‚è¿™å«**å†…å­˜å¯¹é½**ã€‚

```go
type SmallStruct struct {
a bool   // 1å­—èŠ‚
b int64  // 8å­—èŠ‚
}

// ä½ å¯èƒ½ä»¥ä¸ºæ˜¯1 + 8 = 9å­—èŠ‚
// ä½†å®é™…ä¸Šæ˜¯1 + 7(å¡«å……) + 8 = 16å­—èŠ‚
fmt.Println(unsafe.Sizeof(SmallStruct{})) // 16

// å­—æ®µbçš„åç§»é‡ä¸æ˜¯1ï¼Œè€Œæ˜¯8
fmt.Println(unsafe.Offsetof(SmallStruct{}.b)) // 8
```

æˆ‘è§è¿‡å¤ªå¤šäººç¡¬ç¼–ç åç§»é‡ï¼Œç»“æœåœ¨64ä½ç³»ç»Ÿä¸Šè·‘å¾—å¥½å¥½çš„ï¼Œä¸€åˆ°32ä½ç³»ç»Ÿå°±Crashã€‚æ°¸è¿œä¸è¦è¿™æ ·åšï¼š

```go
// è¿™æ ·åšä¼šè¦ä½ çš„å‘½
field1Ptr := (*int)(unsafe.Pointer(uintptr(unsafe.Pointer(&s)) + 8))

//  åº”è¯¥è¿™æ ·åš
field1Ptr := (*int)(unsafe.Pointer(uintptr(unsafe.Pointer(&s)) + unsafe.Offsetof(s.field1)))
```

## Sliceå…¶å®æ˜¯ä¸ªç»“æ„ä½“

Sliceçœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªç®€å•çš„å®¹å™¨ï¼Œä½†åœ¨å†…å­˜é‡Œï¼Œå®ƒå…¶å®æ˜¯è¿™æ ·çš„ï¼š

```go
type sliceHeader struct {
Data unsafe.Pointer // æŒ‡å‘åº•å±‚æ•°ç»„çš„æŒ‡é’ˆ
Len  int            // å½“å‰é•¿åº¦
Cap  int            // å½“å‰å®¹é‡
}
```

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ`unsafe`å¯ä»¥ç›´æ¥ä¿®æ”¹sliceçš„`len`å’Œ`cap`ï¼š

```go
s := []int{1, 2, 3}

// é€šè¿‡unsafeç›´æ¥ä¿®æ”¹sliceçš„å…ƒæ•°æ®
header := (*struct {
Data unsafe.Pointer
Len  int
Cap  int
})(unsafe.Pointer(&s))

header.Len = 5  // ç°åœ¨sçš„é•¿åº¦å˜æˆ5äº†
header.Cap = 5

fmt.Println(s) // [1 2 3 0 0]
```

ä½†è¿™ä¹Ÿæ˜¯æœ€å±é™©çš„æ“ä½œä¹‹ä¸€ã€‚å¦‚æœä½ è®¾ç½®çš„`Len`è¶…è¿‡äº†åº•å±‚æ•°ç»„çš„å®é™…å¤§å°ï¼Œè®¿é—®`s[3]`æˆ–`s[4]`å°±ä¼šè¯»åˆ°éšæœºçš„å†…å­˜å†…å®¹â€”â€”è¿™å«å†…å­˜è¶Šç•Œï¼Œæ˜¯Crashçš„å‰å¥ã€‚

## å…¸å‹çš„åº”ç”¨åœºæ™¯

### 1. é›¶æ‹·è´çš„String â†” []byteè½¬æ¢

> è¿™ç±»ä¼˜åŒ–ï¼Œåœ¨æ—¥å¿—ç³»ç»Ÿã€ç½‘å…³ã€åè®®è§£æå™¨é‡Œï¼Œä¸€æ—¦è§„æ¨¡ä¸Šæ¥ï¼ŒçœŸçš„å°±æ˜¯ï¼š
> **ä¸€æ¬¡æ”¹åŠ¨ï¼Œçœå‡ å°æœºå™¨ã€‚**

åœ¨Goé‡Œï¼Œ`string`å’Œ`[]byte`çš„åº•å±‚ç»“æ„å‡ ä¹ä¸€æ ·ï¼š

```go
// stringçš„ç»“æ„
type stringHeader struct {
Data unsafe.Pointer
Len  int
}

// []byteçš„ç»“æ„
type sliceHeader struct {
Data unsafe.Pointer
Len  int
Cap  int
}
```

å”¯ä¸€çš„åŒºåˆ«æ˜¯sliceå¤šäº†ä¸€ä¸ª`Cap`å­—æ®µã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç›´æ¥"è½¬æ¢"ï¼Œè€Œä¸éœ€è¦æ‹·è´ä»»ä½•æ•°æ®ï¼š

```go
func StringToBytes(s string) []byte {
// è§£æstringçš„å†…å­˜ç»“æ„
strHeader := (*struct {
Data unsafe.Pointer
Len  int
})(unsafe.Pointer(&s))

// æ„é€ []byteçš„å†…å­˜ç»“æ„
sliceHeader := struct {
Data unsafe.Pointer
Len  int
Cap  int
}{
Data: strHeader.Data,
Len:  strHeader.Len,
Cap:  strHeader.Len,  // è®¾ç½®Cap = Lenï¼Œé˜²æ­¢sliceæ‰©å®¹æ—¶ä¿®æ”¹åŸstring
}

return *(*[]byte)(unsafe.Pointer(&sliceHeader))
}
```

æ€§èƒ½å·®å¼‚æœ‰å¤šå¤§ï¼Ÿå½“æˆ‘æŠŠè¿™ä¸ªå‡½æ•°åº”ç”¨åˆ°æˆ‘ä»¬çš„æ—¥å¿—ç³»ç»Ÿæ—¶ï¼š

- **ä¼ ç»Ÿåšæ³•**ï¼ˆ`[]byte(s)`ï¼‰ï¼šå¤„ç†1GBæ—¥å¿—éœ€è¦**1.2ç§’** + **2GBé¢å¤–å†…å­˜**
- **unsafeåšæ³•**ï¼šå¤„ç†1GBæ—¥å¿—ï¼ˆå‡ ä¹æ²¡æœ‰å¼€é”€ï¼‰+ **0å­—èŠ‚é¢å¤–å†…å­˜**

é‚£æ™šï¼Œæˆ‘çš„ä¿®å¤è®©æœåŠ¡çš„å†…å­˜å ç”¨ä»2GBé™åˆ°500MBï¼Œè€æ¿ç»ˆäºè®©æˆ‘ç¡è§‰äº†ã€‚

ä½†æœ‰ä¸ªè‡´å‘½çš„é™·é˜±ï¼šè½¬æ¢åçš„`[]byte`å…¶å®æ˜¯"å€Ÿç”¨"äº†`string`çš„å†…å­˜ã€‚å¦‚æœä½ æ‰‹æ¬ å»ä¿®æ”¹è¿™ä¸ªsliceï¼Œå°±è¿åäº†Goé‡Œ"å­—ç¬¦ä¸²ä¸å¯å˜"çš„å¥‘çº¦ï¼š

```go
s := "hello"
b := StringToBytes(s)
b[0] = 'H'  // è¿™ä¼šä¿®æ”¹åŸstringï¼
fmt.Println(s) // "Hello"ï¼ˆæœªå®šä¹‰è¡Œä¸ºï¼‰
```

æ‰€ä»¥è¿™ä¸ªæŠ€å·§åªèƒ½ç”¨åœ¨"åªè¯»"åœºæ™¯ã€‚å¦‚æœéœ€è¦ä¿®æ”¹ï¼Œè¿˜æ˜¯è€è€å®å®ç”¨`[]byte(s)`å§ã€‚

### 2. äºŒè¿›åˆ¶è§£æ(æ€§èƒ½æå‡50%+)

è¿™æ˜¯ç½‘ç»œç¼–ç¨‹å’Œæ•°æ®å¤„ç†é¢†åŸŸçš„æ€æ‰‹é”ã€‚

å‡è®¾ä½ è¦è§£æä¸€ä¸ªTCPå¤´éƒ¨ï¼ˆ16å­—èŠ‚çš„äºŒè¿›åˆ¶æ•°æ®ï¼‰ã€‚ä¼ ç»Ÿåšæ³•æ˜¯é€ä¸ªå­—æ®µè¯»å–ï¼Œä½†`unsafe`å¯ä»¥ç›´æ¥"å¼ºè½¬"ï¼š

```go
type TCPHeader struct {
SrcPort  uint16
DstPort  uint16
SeqNum   uint32
AckNum   uint32
DataOff  uint8
Flags    uint8
Window   uint16
Checksum uint16
Urgent   uint16
}

// å‡è®¾dataæ˜¯ä»ç½‘ç»œè¯»å–çš„16å­—èŠ‚
if len(data) < int(unsafe.Sizeof(TCPHeader{})) {
panic("data too short")
}
header := (*TCPHeader)(unsafe.Pointer(&data[0]))

// ç°åœ¨å¯ä»¥ç›´æ¥è®¿é—®å­—æ®µ
fmt.Printf("Source Port: %d\n", header.SrcPort)
```

æ€§èƒ½å¯¹æ¯”ï¼ˆè§£æ100ä¸‡ä¸ªTCPå¤´éƒ¨ï¼‰ï¼š

| æ–¹æ³• | è€—æ—¶ |
|------|------|
| encoding/binary | **120ms** |
| unsafeç›´æ¥è½¬æ¢ | **40ms** |
| **æ€§èƒ½æå‡** | **3å€** |

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ`protobuf`ã€`flatbuffers`è¿™äº›é«˜æ€§èƒ½åºåˆ—åŒ–åº“éƒ½åœ¨åº•å±‚ä½¿ç”¨`unsafe`ã€‚

ä½†æœ‰ä¸¤ä¸ªå‰ç½®æ¡ä»¶ï¼š

1. **æ•°æ®é•¿åº¦è¦è¶³å¤Ÿ**ï¼šå¿…é¡»ç¡®ä¿`[]byte`çš„é•¿åº¦ â‰¥ structçš„å¤§å°ï¼Œå¦åˆ™ä¼šè¯»åˆ°éšæœºå†…å­˜
2. **å­—èŠ‚åºè¦åŒ¹é…**ï¼šç½‘ç»œåè®®é€šå¸¸æ˜¯å¤§ç«¯åºï¼ˆbig-endianï¼‰ï¼Œè€Œx86æ˜¯å°ç«¯åºï¼ˆlittle-endianï¼‰ã€‚å¦‚æœä¸è½¬æ¢ï¼Œå­—æ®µå€¼ä¼šå®Œå…¨é”™è¯¯

## æˆ‘è¸©è¿‡çš„ğŸ•³ï¸

æˆ‘ç”¨`unsafe`ä¹Ÿè¸©è¿‡ä¸å°‘å‘ã€‚æœ€æ·±çš„å‡ ä¸ªï¼š

**1. é€ƒé€¸åˆ†æå¤±æ•ˆ**

unsafe ä¼šç ´åç¼–è¯‘å™¨å¯¹æŒ‡é’ˆå…³ç³»çš„åˆ†æï¼Œå¯¼è‡´ï¼š

- æœ¬è¯¥åœ¨æ ˆä¸Šçš„å¯¹è±¡æ›´å®¹æ˜“é€ƒé€¸åˆ°å †ä¸Š
- GCè¯¯åˆ¤å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ

**2. ç‰ˆæœ¬å…¼å®¹æ€§**

Goå®˜æ–¹æ˜ç¡®å£°æ˜ä¸ä¿è¯`unsafe`çš„è¡Œä¸ºåœ¨ç‰ˆæœ¬å‡çº§åä¿æŒä¸€è‡´ã€‚æˆ‘çš„ä¸€ä¸ªæœ‹å‹å°±å› ä¸ºè¿™ä¸ªåƒè¿‡äºï¼šä»–åœ¨Go 1.18ä¸Šç”¨`unsafe`ä¼˜åŒ–çš„ä»£ç ï¼Œå‡çº§åˆ°Go 1.20åç›´æ¥å´©æºƒäº†ã€‚èŠ±äº†ä¸¤å¤©æ‰æ‰¾åˆ°åŸå› ã€‚

**3. Interfaceçš„åŒé‡èº«ä»½**

è¿™é‡Œæ¶‰åŠ interface çš„å†…å­˜ç»“æ„å·®å¼‚ï¼Œå±•å¼€è®²åˆæ˜¯ä¸€ç¯‡æ–‡ç« ï¼Œè¿™é‡Œåªè¯´ç»“è®ºï¼š

- ç©ºæ¥å£å’Œéç©ºæ¥å£ç»“æ„ä¸åŒ
- ä¸èƒ½ç”¨åŒä¸€ç§ unsafe è½¬æ¢æ–¹å¼, å¦åˆ™å°±æ˜¯æœªå®šä¹‰è¡Œä¸º

## æ€ä¹ˆç”¨å¥½â€˜unsafeâ€™

ç»è¿‡é‚£æ™šçš„æ•™è®­ï¼Œæˆ‘å¯¹`unsafe`çš„æ€åº¦æ”¹å˜äº†ã€‚ä¸æ˜¯å®Œå…¨é¿å…ï¼Œè€Œæ˜¯æ›´è°¨æ…ã€‚

**ç¬¬ä¸€æ¡ï¼šç†è§£åŸç†**

ææ‡‚`unsafe.Pointer`å’Œ`uintptr`çš„åŒºåˆ«ï¼Œç†è§£Goçš„å†…å­˜å¯¹é½è§„åˆ™ï¼ŒæŒæ¡struct/slice/interfaceçš„å†…å­˜å¸ƒå±€ã€‚è¿™ä¸æ˜¯å¯é€‰çš„â€”â€”è¿™æ˜¯ä½¿ç”¨`unsafe`çš„å‰æã€‚

**ç¬¬äºŒæ¡ï¼šä¸¥è°¨å°è£…**

æ°¸è¿œæŠŠ`unsafe`æ“ä½œå…³åœ¨æœ€å°çš„èŒƒå›´å†…ã€‚æœ€å¥½æ˜¯å†™æˆä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°æˆ–åŒ…ï¼Œè¿™æ ·å®¹æ˜“é›†ä¸­ç®¡ç†å’Œå®¡æŸ¥ï¼Œå¦‚æœå‡ºé—®é¢˜ä¹ŸçŸ¥é“ä»å“ªå„¿å¼€å§‹æ‰¾ã€‚

```go
//  å¥½çš„åšæ³•ï¼šå°è£…åœ¨ä¸€ä¸ªå‡½æ•°é‡Œ
func StringToBytes(s string) []byte {
// unsafeæ“ä½œé›†ä¸­åœ¨è¿™é‡Œ
// æ‰€æœ‰çš„å®‰å…¨æ£€æŸ¥ä¹Ÿåœ¨è¿™é‡Œ
}

//  åçš„åšæ³•ï¼šåˆ°å¤„éƒ½æ˜¯unsafe
func ProcessLog(log string) {
// è¿™å„¿ä¸€ä¸ªunsafe
// é‚£å„¿ä¸€ä¸ªunsafe
// æ•´ä¸ªå‡½æ•°éƒ½æ˜¯é›·åŒº
}
```

**ç¬¬ä¸‰æ¡ï¼šå®‰å…¨ç¬¬ä¸€**

é™¤éæ€§èƒ½ç“¶é¢ˆç¡®å®å¡åœ¨è¿™å„¿äº†ï¼ˆç”¨pprofè¯æ˜ï¼‰ï¼Œå¦åˆ™ä¼˜å…ˆé€‰æ‹©æ ‡å‡†åº“ã€‚Goçš„æ ‡å‡†åº“å·²ç»å¾ˆå¿«äº†ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ä¸éœ€è¦`unsafe`ã€‚

**ç¬¬å››æ¡ï¼šå……åˆ†æµ‹è¯•**

ç”¨`unsafe`çš„ä»£ç ä¸€å®šè¦å†™å•å…ƒæµ‹è¯•ï¼Œåœ¨ä¸åŒå¹³å°æµ‹è¯•ï¼ˆLinux/macOS/Windowsï¼Œ32ä½/64ä½ï¼‰ï¼Œåœ¨ä¸åŒGoç‰ˆæœ¬æµ‹è¯•ï¼Œç”¨å†…å­˜æ£€æŸ¥å·¥å…·æ£€æŸ¥ã€‚

## æœ€å

`unsafe`ä¸æ˜¯ç¦å¿Œï¼Œè€Œæ˜¯å·¥å…·ã€‚å…³é”®æ˜¯è¦çŸ¥é“ä»€ä¹ˆæ—¶å€™ç”¨ï¼Œæ€ä¹ˆç”¨ï¼Œä»¥åŠä»€ä¹ˆæ—¶å€™ç»å¯¹ä¸èƒ½ç”¨ã€‚

ä½ æ›¾åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨è¿‡`unsafe`å—ï¼Ÿæ˜¯è§£å†³äº†æ€§èƒ½é—®é¢˜ï¼Œè¿˜æ˜¯è¸©åˆ°äº†æŸä¸ªé›·åŒºï¼Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„ç»å†ã€‚

å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç‚¹ä¸ª"åœ¨çœ‹"ï¼Œè®©æ›´å¤šçš„gopherçœ‹åˆ°ã€‚
